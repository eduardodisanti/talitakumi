<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="EmitirCarnets" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<parameter name="fecha_desde" class="java.util.Date"/>
	<parameter name="token" class="java.lang.Long"/>
	<queryString>
		<![CDATA[select personas.nombres, personas.apellidos, personas.fechanacimiento, episodios.fecha, DATE_ADD(episodios.fecha, INTERVAL vigencia MONTH)as vence, personas.sexo, personas.documento, tipoepisodio
        from	carnetdesalud, personas, episodios
	where 	vigencia > 6            and
		episodios.id = episodio and
		personas.id  = paciente and
		impreso = $P{token}
FOR UPDATE]]>
	</queryString>
	<field name="nombres" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="apellidos" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="fechanacimiento" class="java.sql.Date">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="fecha" class="java.sql.Date">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="vence" class="java.sql.Date">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="sexo" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="documento" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="tipoepisodio" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<variable name="comentario" class="java.lang.String">
		<variableExpression><![CDATA[$F{tipoepisodio}.intValue() == 4   ||
$F{tipoepisodio}.intValue() == 7   ||
$F{tipoepisodio}.intValue() == 400  ||
$F{tipoepisodio}.intValue() == 700  ||
$F{tipoepisodio}.intValue() == 4000 ||
$F{tipoepisodio}.intValue() == 7000 ? new java.lang.String("APTITUD FISICA") :
    ($F{tipoepisodio}.intValue() == 3     ||
     $F{tipoepisodio}.intValue() == 301   ||
     $F{tipoepisodio}.intValue() == 3001  ? new java.lang.String("APTO PARA RADICACION")
                                    : new java.lang.String(" ")
    )]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band splitType="Stretch"/>
	</title>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band splitType="Stretch"/>
	</columnHeader>
	<detail>
		<band height="156" splitType="Stretch">
			<textField>
				<reportElement x="332" y="1" width="223" height="14"/>
				<textElement verticalAlignment="Bottom"/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{nombres}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="332" y="16" width="223" height="14"/>
				<textElement verticalAlignment="Bottom"/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{apellidos}]]></textFieldExpression>
			</textField>
			<textField pattern="">
				<reportElement x="332" y="32" width="223" height="15"/>
				<textElement verticalAlignment="Bottom"/>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$F{documento}]]></textFieldExpression>
			</textField>
			<textField pattern="dd">
				<reportElement x="334" y="50" width="21" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Bottom"/>
				<textFieldExpression class="java.util.Date"><![CDATA[$F{fechanacimiento}]]></textFieldExpression>
			</textField>
			<textField pattern="MM">
				<reportElement x="357" y="50" width="30" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Bottom"/>
				<textFieldExpression class="java.util.Date"><![CDATA[$F{fechanacimiento}]]></textFieldExpression>
			</textField>
			<textField pattern="yy">
				<reportElement x="388" y="50" width="15" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Bottom"/>
				<textFieldExpression class="java.util.Date"><![CDATA[$F{fechanacimiento}]]></textFieldExpression>
			</textField>
			<textField pattern="dd">
				<reportElement x="334" y="70" width="21" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.util.Date"><![CDATA[$F{fecha}]]></textFieldExpression>
			</textField>
			<textField pattern="MM">
				<reportElement x="357" y="70" width="30" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.util.Date"><![CDATA[$F{fecha}]]></textFieldExpression>
			</textField>
			<textField pattern="yy">
				<reportElement x="388" y="70" width="15" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.util.Date"><![CDATA[$F{fecha}]]></textFieldExpression>
			</textField>
			<textField pattern="yy">
				<reportElement x="388" y="91" width="15" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.util.Date"><![CDATA[$F{vence}]]></textFieldExpression>
			</textField>
			<textField pattern="dd">
				<reportElement x="334" y="91" width="21" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.util.Date"><![CDATA[$F{vence}]]></textFieldExpression>
			</textField>
			<textField pattern="MM">
				<reportElement x="357" y="91" width="30" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression class="java.util.Date"><![CDATA[$F{vence}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="135" y="45" width="148" height="20"/>
				<textElement/>
				<textFieldExpression class="java.lang.String"><![CDATA[$V{comentario}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="328" y="114" width="21" height="20"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{sexo}.equals("F") ? new java.lang.String("X") : new java.lang.String(" ")]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="382" y="114" width="21" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Top"/>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{sexo}.equals("M") ? new java.lang.String("X") : new java.lang.String(" ")]]></textFieldExpression>
			</textField>
			<image>
				<reportElement x="435" y="75" width="71" height="56"/>
				<imageExpression class="java.lang.String"><![CDATA["fgm.jpg"]]></imageExpression>
			</image>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band splitType="Stretch"/>
	</pageFooter>
	<summary>
		<band splitType="Stretch"/>
	</summary>
</jasperReport>
